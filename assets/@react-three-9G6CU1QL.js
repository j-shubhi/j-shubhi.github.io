import{r as b,j as N}from"./react-Dj7XyvXL.js";import{R as Je,V as Qe,a as Y,L as me,b as yt,U as wt,O as bt,P as Et,S as _t,c as ge,N as St,A as Ct,W as Mt,C as Pt,B as xt,d as Rt,e as jt,f as Ot,T as kt,G as je,M as Ze,g as Oe,h as Tt,i as Lt,j as It}from"./three-D23Su5Ny.js";import{j as At}from"./react-use-measure-CqHo_8DU.js";import{F as zt,u as Ft}from"./its-fine-CjUeqwzf.js";import{R as Dt,c as re}from"./react-reconciler-CRzrnbRv.js";import{c as he}from"./zustand-ByxO7icO.js";import{G as Nt,f as Bt,M as Ht,a as ve}from"./three-stdlib-vNVfpC4M.js";var Fn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var et={exports:{}},tt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(E,P){var C=E.length;E.push(P);e:for(;0<C;){var R=C-1>>>1,I=E[R];if(0<l(I,P))E[R]=P,E[C]=I,C=R;else break e}}function n(E){return E.length===0?null:E[0]}function i(E){if(E.length===0)return null;var P=E[0],C=E.pop();if(C!==P){E[0]=C;e:for(var R=0,I=E.length,A=I>>>1;R<A;){var B=2*(R+1)-1,$=E[B],W=B+1,ue=E[W];if(0>l($,C))W<I&&0>l(ue,$)?(E[R]=ue,E[W]=C,R=W):(E[R]=$,E[B]=C,R=B);else if(W<I&&0>l(ue,C))E[R]=ue,E[W]=C,R=W;else break e}}return P}function l(E,P){var C=E.sortIndex-P.sortIndex;return C!==0?C:E.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;e.unstable_now=function(){return v.now()}}else{var u=Date,p=u.now();e.unstable_now=function(){return u.now()-p}}var s=[],m=[],o=1,r=null,a=3,c=!1,f=!1,w=!1,y=typeof setTimeout=="function"?setTimeout:null,d=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function h(E){for(var P=n(m);P!==null;){if(P.callback===null)i(m);else if(P.startTime<=E)i(m),P.sortIndex=P.expirationTime,t(s,P);else break;P=n(m)}}function S(E){if(w=!1,h(E),!f)if(n(s)!==null)f=!0,X(_);else{var P=n(m);P!==null&&V(S,P.startTime-E)}}function _(E,P){f=!1,w&&(w=!1,d(j),j=-1),c=!0;var C=a;try{for(h(P),r=n(s);r!==null&&(!(r.expirationTime>P)||E&&!M());){var R=r.callback;if(typeof R=="function"){r.callback=null,a=r.priorityLevel;var I=R(r.expirationTime<=P);P=e.unstable_now(),typeof I=="function"?r.callback=I:r===n(s)&&i(s),h(P)}else i(s);r=n(s)}if(r!==null)var A=!0;else{var B=n(m);B!==null&&V(S,B.startTime-P),A=!1}return A}finally{r=null,a=C,c=!1}}var x=!1,O=null,j=-1,k=5,T=-1;function M(){return!(e.unstable_now()-T<k)}function L(){if(O!==null){var E=e.unstable_now();T=E;var P=!0;try{P=O(!0,E)}finally{P?F():(x=!1,O=null)}}else x=!1}var F;if(typeof g=="function")F=function(){g(L)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,J=U.port2;U.port1.onmessage=L,F=function(){J.postMessage(null)}}else F=function(){y(L,0)};function X(E){O=E,x||(x=!0,F())}function V(E,P){j=y(function(){E(e.unstable_now())},P)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(E){E.callback=null},e.unstable_continueExecution=function(){f||c||(f=!0,X(_))},e.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<E?Math.floor(1e3/E):5},e.unstable_getCurrentPriorityLevel=function(){return a},e.unstable_getFirstCallbackNode=function(){return n(s)},e.unstable_next=function(E){switch(a){case 1:case 2:case 3:var P=3;break;default:P=a}var C=a;a=P;try{return E()}finally{a=C}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(E,P){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var C=a;a=E;try{return P()}finally{a=C}},e.unstable_scheduleCallback=function(E,P,C){var R=e.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?R+C:R):C=R,E){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=C+I,E={id:o++,callback:P,priorityLevel:E,startTime:C,expirationTime:I,sortIndex:-1},C>R?(E.sortIndex=C,t(m,E),n(s)===null&&E===n(m)&&(w?(d(j),j=-1):w=!0,V(S,C-R))):(E.sortIndex=I,t(s,E),f||c||(f=!0,X(_))),E},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(E){var P=a;return function(){var C=a;a=P;try{return E.apply(this,arguments)}finally{a=C}}}})(tt);et.exports=tt;var Ae=et.exports;const ke={},nt=e=>void Object.assign(ke,e);function qt(e,t){function n(o,{args:r=[],attach:a,...c},f){let w=`${o[0].toUpperCase()}${o.slice(1)}`,y;if(o==="primitive"){if(c.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const d=c.object;y=te(d,{type:o,root:f,attach:a,primitive:!0})}else{const d=ke[w];if(!d)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");y=te(new d(...r),{type:o,root:f,attach:a,memoizedProps:{args:r}})}return y.__r3f.attach===void 0&&(y.isBufferGeometry?y.__r3f.attach="geometry":y.isMaterial&&(y.__r3f.attach="material")),w!=="inject"&&be(y,c),y}function i(o,r){let a=!1;if(r){var c,f;(c=r.__r3f)!=null&&c.attach?we(o,r,r.__r3f.attach):r.isObject3D&&o.isObject3D&&(o.add(r),a=!0),a||(f=o.__r3f)==null||f.objects.push(r),r.__r3f||te(r,{}),r.__r3f.parent=o,xe(r),ne(r)}}function l(o,r,a){let c=!1;if(r){var f,w;if((f=r.__r3f)!=null&&f.attach)we(o,r,r.__r3f.attach);else if(r.isObject3D&&o.isObject3D){r.parent=o,r.dispatchEvent({type:"added"}),o.dispatchEvent({type:"childadded",child:r});const y=o.children.filter(g=>g!==r),d=y.indexOf(a);o.children=[...y.slice(0,d),r,...y.slice(d)],c=!0}c||(w=o.__r3f)==null||w.objects.push(r),r.__r3f||te(r,{}),r.__r3f.parent=o,xe(r),ne(r)}}function v(o,r,a=!1){o&&[...o].forEach(c=>u(r,c,a))}function u(o,r,a){if(r){var c,f,w;if(r.__r3f&&(r.__r3f.parent=null),(c=o.__r3f)!=null&&c.objects&&(o.__r3f.objects=o.__r3f.objects.filter(S=>S!==r)),(f=r.__r3f)!=null&&f.attach)Be(o,r,r.__r3f.attach);else if(r.isObject3D&&o.isObject3D){var y;o.remove(r),(y=r.__r3f)!=null&&y.root&&Yt(pe(r),r)}const g=(w=r.__r3f)==null?void 0:w.primitive,h=!g&&(a===void 0?r.dispose!==null:a);if(!g){var d;v((d=r.__r3f)==null?void 0:d.objects,r,h),v(r.children,r,h)}if(delete r.__r3f,h&&r.dispose&&r.type!=="Scene"){const S=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Ae.unstable_scheduleCallback(Ae.unstable_IdlePriority,S):S()}ne(o)}}function p(o,r,a,c){var f;const w=(f=o.__r3f)==null?void 0:f.parent;if(!w)return;const y=n(r,a,o.__r3f.root);if(o.children){for(const d of o.children)d.__r3f&&i(y,d);o.children=o.children.filter(d=>!d.__r3f)}o.__r3f.objects.forEach(d=>i(y,d)),o.__r3f.objects=[],o.__r3f.autoRemovedBeforeAppend||u(w,o),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(w,y),y.raycast&&y.__r3f.eventCount&&pe(y).getState().internal.interaction.push(y),[c,c.alternate].forEach(d=>{d!==null&&(d.stateNode=y,d.ref&&(typeof d.ref=="function"?d.ref(y):d.ref.current=y))})}const s=()=>{};return{reconciler:Dt({createInstance:n,removeChild:u,appendChild:i,appendInitialChild:i,insertBefore:l,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(o,r)=>{if(!r)return;const a=o.getState().scene;a.__r3f&&(a.__r3f.root=o,i(a,r))},removeChildFromContainer:(o,r)=>{r&&u(o.getState().scene,r)},insertInContainerBefore:(o,r,a)=>{if(!r||!a)return;const c=o.getState().scene;c.__r3f&&l(c,r,a)},getRootHostContext:()=>null,getChildHostContext:o=>o,finalizeInitialChildren(o){var r;return!!((r=o==null?void 0:o.__r3f)!=null?r:{}).handlers},prepareUpdate(o,r,a,c){var f;if(((f=o==null?void 0:o.__r3f)!=null?f:{}).primitive&&c.object&&c.object!==o)return[!0];{const{args:y=[],children:d,...g}=c,{args:h=[],children:S,..._}=a;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((O,j)=>O!==h[j]))return[!0];const x=ct(o,g,_,!0);return x.changes.length?[!1,x]:null}},commitUpdate(o,[r,a],c,f,w,y){r?p(o,c,w,y):be(o,a)},commitMount(o,r,a,c){var f;const w=(f=o.__r3f)!=null?f:{};o.raycast&&w.handlers&&w.eventCount&&pe(o).getState().internal.interaction.push(o)},getPublicInstance:o=>o,prepareForCommit:()=>null,preparePortalMount:o=>te(o.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(o){var r;const{attach:a,parent:c}=(r=o.__r3f)!=null?r:{};a&&c&&Be(c,o,a),o.isObject3D&&(o.visible=!1),ne(o)},unhideInstance(o,r){var a;const{attach:c,parent:f}=(a=o.__r3f)!=null?a:{};c&&f&&we(f,o,c),(o.isObject3D&&r.visible==null||r.visible)&&(o.visible=!0),ne(o)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():re.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&z.fun(performance.now)?performance.now:z.fun(Date.now)?Date.now:()=>0,scheduleTimeout:z.fun(setTimeout)?setTimeout:void 0,cancelTimeout:z.fun(clearTimeout)?clearTimeout:void 0}),applyProps:be}}var ze,Fe;const ye=e=>"colorSpace"in e||"outputColorSpace"in e,rt=()=>{var e;return(e=ke.ColorManagement)!=null?e:null},ot=e=>e&&e.isOrthographicCamera,Gt=e=>e&&e.hasOwnProperty("current"),ce=typeof window<"u"&&((ze=window.document)!=null&&ze.createElement||((Fe=window.navigator)==null?void 0:Fe.product)==="ReactNative")?b.useLayoutEffect:b.useEffect;function it(e){const t=b.useRef(e);return ce(()=>void(t.current=e),[e]),t}function Xt({set:e}){return ce(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class st extends b.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}st.getDerivedStateFromError=()=>({error:!0});const at="__default",De=new Map,Ut=e=>e&&!!e.memoized&&!!e.changes;function lt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const ie=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function pe(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const z={obj:e=>e===Object(e)&&!z.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:l=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(z.str(e)||z.num(e)||z.boo(e))return e===t;const v=z.obj(e);if(v&&i==="reference")return e===t;const u=z.arr(e);if(u&&n==="reference")return e===t;if((u||v)&&e===t)return!0;let p;for(p in e)if(!(p in t))return!1;if(v&&n==="shallow"&&i==="shallow"){for(p in l?t:e)if(!z.equ(e[p],t[p],{strict:l,objects:"reference"}))return!1}else for(p in l?t:e)if(e[p]!==t[p])return!1;if(z.und(p)){if(u&&e.length===0&&t.length===0||v&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Vt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function te(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Pe(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),l=i.pop();return n=i.reduce((v,u)=>v[u],e),{target:n,key:l}}else return{target:n,key:t}}const Ne=/-\d+$/;function we(e,t,n){if(z.str(n)){if(Ne.test(n)){const v=n.replace(Ne,""),{target:u,key:p}=Pe(e,v);Array.isArray(u[p])||(u[p]=[])}const{target:i,key:l}=Pe(e,n);t.__r3f.previousAttach=i[l],i[l]=t}else t.__r3f.previousAttach=n(e,t)}function Be(e,t,n){var i,l;if(z.str(n)){const{target:v,key:u}=Pe(e,n),p=t.__r3f.previousAttach;p===void 0?delete v[u]:v[u]=p}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(l=t.__r3f)==null||delete l.previousAttach}function ct(e,{children:t,key:n,ref:i,...l},{children:v,key:u,ref:p,...s}={},m=!1){const o=e.__r3f,r=Object.entries(l),a=[];if(m){const f=Object.keys(s);for(let w=0;w<f.length;w++)l.hasOwnProperty(f[w])||r.unshift([f[w],at+"remove"])}r.forEach(([f,w])=>{var y;if((y=e.__r3f)!=null&&y.primitive&&f==="object"||z.equ(w,s[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return a.push([f,w,!0,[]]);let d=[];f.includes("-")&&(d=f.split("-")),a.push([f,w,!1,d]);for(const g in l){const h=l[g];g.startsWith(`${f}-`)&&a.push([g,h,!1,g.split("-")])}});const c={...l};return o!=null&&o.memoizedProps&&o!=null&&o.memoizedProps.args&&(c.args=o.memoizedProps.args),o!=null&&o.memoizedProps&&o!=null&&o.memoizedProps.attach&&(c.attach=o.memoizedProps.attach),{memoized:c,changes:a}}const $t=typeof process<"u"&&!1;function be(e,t){var n;const i=e.__r3f,l=i==null?void 0:i.root,v=l==null||l.getState==null?void 0:l.getState(),{memoized:u,changes:p}=Ut(t)?t:ct(e,t),s=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=u);for(let a=0;a<p.length;a++){let[c,f,w,y]=p[a];if(ye(e)){const S="srgb",_="srgb-linear";c==="encoding"?(c="colorSpace",f=f===3001?S:_):c==="outputEncoding"&&(c="outputColorSpace",f=f===3001?S:_)}let d=e,g=d[c];if(y.length&&(g=y.reduce((h,S)=>h[S],e),!(g&&g.set))){const[h,...S]=y.reverse();d=S.reverse().reduce((_,x)=>_[x],e),c=h}if(f===at+"remove")if(d.constructor){let h=De.get(d.constructor);h||(h=new d.constructor,De.set(d.constructor,h)),f=h[c]}else f=0;if(w&&i)f?i.handlers[c]=f:delete i.handlers[c],i.eventCount=Object.keys(i.handlers).length;else if(g&&g.set&&(g.copy||g instanceof me)){if(Array.isArray(f))g.fromArray?g.fromArray(f):g.set(...f);else if(g.copy&&f&&f.constructor&&($t?g.constructor.name===f.constructor.name:g.constructor===f.constructor))g.copy(f);else if(f!==void 0){var m;const h=(m=g)==null?void 0:m.isColor;!h&&g.setScalar?g.setScalar(f):g instanceof me&&f instanceof me?g.mask=f.mask:g.set(f),!rt()&&v&&!v.linear&&h&&g.convertSRGBToLinear()}}else{var o;if(d[c]=f,(o=d[c])!=null&&o.isTexture&&d[c].format===yt&&d[c].type===wt&&v){const h=d[c];ye(h)&&ye(v.gl)?h.colorSpace=v.gl.outputColorSpace:h.encoding=v.gl.outputEncoding}}ne(e)}if(i&&i.parent&&e.raycast&&s!==i.eventCount){const a=pe(e).getState().internal,c=a.interaction.indexOf(e);c>-1&&a.interaction.splice(c,1),i.eventCount&&a.interaction.push(e)}return!(p.length===1&&p[0][0]==="onUpdate")&&p.length&&(n=e.__r3f)!=null&&n.parent&&xe(e),e}function ne(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function xe(e){e.onUpdate==null||e.onUpdate(e)}function ut(e,t){e.manual||(ot(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function fe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Wt(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return re.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return re.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return re.ContinuousEventPriority;default:return re.DefaultEventPriority}}function ft(e,t,n,i){const l=n.get(t);l&&(n.delete(t),n.size===0&&(e.delete(i),l.target.releasePointerCapture(i)))}function Yt(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,l)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(l)}),n.capturedMap.forEach((i,l)=>{ft(n.capturedMap,t,i,l)})}function Kt(e){function t(s){const{internal:m}=e.getState(),o=s.offsetX-m.initialClick[0],r=s.offsetY-m.initialClick[1];return Math.round(Math.sqrt(o*o+r*r))}function n(s){return s.filter(m=>["Move","Over","Enter","Out","Leave"].some(o=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+o]}))}function i(s,m){const o=e.getState(),r=new Set,a=[],c=m?m(o.internal.interaction):o.internal.interaction;for(let d=0;d<c.length;d++){const g=ie(c[d]);g&&(g.raycaster.camera=void 0)}o.previousRoot||o.events.compute==null||o.events.compute(s,o);function f(d){const g=ie(d);if(!g||!g.events.enabled||g.raycaster.camera===null)return[];if(g.raycaster.camera===void 0){var h;g.events.compute==null||g.events.compute(s,g,(h=g.previousRoot)==null?void 0:h.getState()),g.raycaster.camera===void 0&&(g.raycaster.camera=null)}return g.raycaster.camera?g.raycaster.intersectObject(d,!0):[]}let w=c.flatMap(f).sort((d,g)=>{const h=ie(d.object),S=ie(g.object);return!h||!S?d.distance-g.distance:S.events.priority-h.events.priority||d.distance-g.distance}).filter(d=>{const g=fe(d);return r.has(g)?!1:(r.add(g),!0)});o.events.filter&&(w=o.events.filter(w,o));for(const d of w){let g=d.object;for(;g;){var y;(y=g.__r3f)!=null&&y.eventCount&&a.push({...d,eventObject:g}),g=g.parent}}if("pointerId"in s&&o.internal.capturedMap.has(s.pointerId))for(let d of o.internal.capturedMap.get(s.pointerId).values())r.has(fe(d.intersection))||a.push(d.intersection);return a}function l(s,m,o,r){const a=e.getState();if(s.length){const c={stopped:!1};for(const f of s){const w=ie(f.object)||a,{raycaster:y,pointer:d,camera:g,internal:h}=w,S=new Y(d.x,d.y,0).unproject(g),_=T=>{var M,L;return(M=(L=h.capturedMap.get(T))==null?void 0:L.has(f.eventObject))!=null?M:!1},x=T=>{const M={intersection:f,target:m.target};h.capturedMap.has(T)?h.capturedMap.get(T).set(f.eventObject,M):h.capturedMap.set(T,new Map([[f.eventObject,M]])),m.target.setPointerCapture(T)},O=T=>{const M=h.capturedMap.get(T);M&&ft(h.capturedMap,f.eventObject,M,T)};let j={};for(let T in m){let M=m[T];typeof M!="function"&&(j[T]=M)}let k={...f,...j,pointer:d,intersections:s,stopped:c.stopped,delta:o,unprojectedPoint:S,ray:y.ray,camera:g,stopPropagation(){const T="pointerId"in m&&h.capturedMap.get(m.pointerId);if((!T||T.has(f.eventObject))&&(k.stopped=c.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find(M=>M.eventObject===f.eventObject))){const M=s.slice(0,s.indexOf(f));v([...M,f])}},target:{hasPointerCapture:_,setPointerCapture:x,releasePointerCapture:O},currentTarget:{hasPointerCapture:_,setPointerCapture:x,releasePointerCapture:O},nativeEvent:m};if(r(k),c.stopped===!0)break}}return s}function v(s){const{internal:m}=e.getState();for(const o of m.hovered.values())if(!s.length||!s.find(r=>r.object===o.object&&r.index===o.index&&r.instanceId===o.instanceId)){const a=o.eventObject.__r3f,c=a==null?void 0:a.handlers;if(m.hovered.delete(fe(o)),a!=null&&a.eventCount){const f={...o,intersections:s};c.onPointerOut==null||c.onPointerOut(f),c.onPointerLeave==null||c.onPointerLeave(f)}}}function u(s,m){for(let o=0;o<m.length;o++){const r=m[o].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(s)}}function p(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>v([]);case"onLostPointerCapture":return m=>{const{internal:o}=e.getState();"pointerId"in m&&o.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{o.capturedMap.has(m.pointerId)&&(o.capturedMap.delete(m.pointerId),v([]))})}}return function(o){const{onPointerMissed:r,internal:a}=e.getState();a.lastEvent.current=o;const c=s==="onPointerMove",f=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",y=i(o,c?n:void 0),d=f?t(o):0;s==="onPointerDown"&&(a.initialClick=[o.offsetX,o.offsetY],a.initialHits=y.map(h=>h.eventObject)),f&&!y.length&&d<=2&&(u(o,a.interaction),r&&r(o)),c&&v(y);function g(h){const S=h.eventObject,_=S.__r3f,x=_==null?void 0:_.handlers;if(_!=null&&_.eventCount)if(c){if(x.onPointerOver||x.onPointerEnter||x.onPointerOut||x.onPointerLeave){const O=fe(h),j=a.hovered.get(O);j?j.stopped&&h.stopPropagation():(a.hovered.set(O,h),x.onPointerOver==null||x.onPointerOver(h),x.onPointerEnter==null||x.onPointerEnter(h))}x.onPointerMove==null||x.onPointerMove(h)}else{const O=x[s];O?(!f||a.initialHits.includes(S))&&(u(o,a.interaction.filter(j=>!a.initialHits.includes(j))),O(h)):f&&a.initialHits.includes(S)&&u(o,a.interaction.filter(j=>!a.initialHits.includes(j)))}}l(y,o,d,g)}}return{handlePointer:p}}const Jt=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],dt=e=>!!(e!=null&&e.render),Te=b.createContext(null),Qt=(e,t)=>{const n=he((p,s)=>{const m=new Y,o=new Y,r=new Y;function a(d=s().camera,g=o,h=s().size){const{width:S,height:_,top:x,left:O}=h,j=S/_;g.isVector3?r.copy(g):r.set(...g);const k=d.getWorldPosition(m).distanceTo(r);if(ot(d))return{width:S/d.zoom,height:_/d.zoom,top:x,left:O,factor:1,distance:k,aspect:j};{const T=d.fov*Math.PI/180,M=2*Math.tan(T/2)*k,L=M*(S/_);return{width:L,height:M,top:x,left:O,factor:S/L,distance:k,aspect:j}}}let c;const f=d=>p(g=>({performance:{...g.performance,current:d}})),w=new Qe;return{set:p,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(d=1)=>e(s(),d),advance:(d,g)=>t(d,g,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Ot,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const d=s();c&&clearTimeout(c),d.performance.current!==d.performance.min&&f(d.performance.min),c=setTimeout(()=>f(s().performance.max),d.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:a},setEvents:d=>p(g=>({...g,events:{...g.events,...d}})),setSize:(d,g,h,S,_)=>{const x=s().camera,O={width:d,height:g,top:S||0,left:_||0,updateStyle:h};p(j=>({size:O,viewport:{...j.viewport,...a(x,o,O)}}))},setDpr:d=>p(g=>{const h=lt(d);return{viewport:{...g.viewport,dpr:h,initialDpr:g.viewport.initialDpr||h}}}),setFrameloop:(d="always")=>{const g=s().clock;g.stop(),g.elapsedTime=0,d!=="never"&&(g.start(),g.elapsedTime=0),p(()=>({frameloop:d}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:b.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(d,g,h)=>{const S=s().internal;return S.priority=S.priority+(g>0?1:0),S.subscribers.push({ref:d,priority:g,store:h}),S.subscribers=S.subscribers.sort((_,x)=>_.priority-x.priority),()=>{const _=s().internal;_!=null&&_.subscribers&&(_.priority=_.priority-(g>0?1:0),_.subscribers=_.subscribers.filter(x=>x.ref!==d))}}}}}),i=n.getState();let l=i.size,v=i.viewport.dpr,u=i.camera;return n.subscribe(()=>{const{camera:p,size:s,viewport:m,gl:o,set:r}=n.getState();if(s.width!==l.width||s.height!==l.height||m.dpr!==v){var a;l=s,v=m.dpr,ut(p,s),o.setPixelRatio(m.dpr);const c=(a=s.updateStyle)!=null?a:typeof HTMLCanvasElement<"u"&&o.domElement instanceof HTMLCanvasElement;o.setSize(s.width,s.height,c)}p!==u&&(u=p,r(c=>({viewport:{...c.viewport,...c.viewport.getCurrentViewport(p)}})))}),n.subscribe(p=>e(p)),n};let de,Zt=new Set,en=new Set,tn=new Set;function Ee(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function se(e,t){switch(e){case"before":return Ee(Zt,t);case"after":return Ee(en,t);case"tail":return Ee(tn,t)}}let _e,Se;function Ce(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),_e=t.internal.subscribers,de=0;de<_e.length;de++)Se=_e[de],Se.ref.current(Se.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function nn(e){let t=!1,n=!1,i,l,v;function u(m){l=requestAnimationFrame(u),t=!0,i=0,se("before",m),n=!0;for(const r of e.values()){var o;v=r.store.getState(),v.internal.active&&(v.frameloop==="always"||v.internal.frames>0)&&!((o=v.gl.xr)!=null&&o.isPresenting)&&(i+=Ce(m,v))}if(n=!1,se("after",m),i===0)return se("tail",m),t=!1,cancelAnimationFrame(l)}function p(m,o=1){var r;if(!m)return e.forEach(a=>p(a.store.getState(),o));(r=m.gl.xr)!=null&&r.isPresenting||!m.internal.active||m.frameloop==="never"||(o>1?m.internal.frames=Math.min(60,m.internal.frames+o):n?m.internal.frames=2:m.internal.frames=1,t||(t=!0,requestAnimationFrame(u)))}function s(m,o=!0,r,a){if(o&&se("before",m),r)Ce(m,r,a);else for(const c of e.values())Ce(m,c.store.getState());o&&se("after",m)}return{loop:u,invalidate:p,advance:s}}function Le(){const e=b.useContext(Te);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function ae(e=n=>n,t){return Le()(e,t)}function Ie(e,t=0){const n=Le(),i=n.getState().internal.subscribe,l=it(e);return ce(()=>i(l,t,n),[t,i,n]),null}const oe=new Map,{invalidate:He,advance:qe}=nn(oe),{reconciler:le,applyProps:Q}=qt(oe,Wt),Z={objects:"shallow",strict:!1},rn=(e,t)=>{const n=typeof e=="function"?e(t):e;return dt(n)?n:new Mt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function on(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:l,top:v,left:u,updateStyle:p=n}=t;return{width:i,height:l,top:v,left:u,updateStyle:p}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:l,top:v,left:u}=e.parentElement.getBoundingClientRect();return{width:i,height:l,top:v,left:u,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function sn(e){const t=oe.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const l=typeof reportError=="function"?reportError:console.error,v=i||Qt(He,qe),u=n||le.createContainer(v,re.ConcurrentRoot,null,!1,null,"",l,null);t||oe.set(e,{fiber:u,store:v});let p,s=!1,m;return{configure(o={}){let{gl:r,size:a,scene:c,events:f,onCreated:w,shadows:y=!1,linear:d=!1,flat:g=!1,legacy:h=!1,orthographic:S=!1,frameloop:_="always",dpr:x=[1,2],performance:O,raycaster:j,camera:k,onPointerMissed:T}=o,M=v.getState(),L=M.gl;M.gl||M.set({gl:L=rn(r,e)});let F=M.raycaster;F||M.set({raycaster:F=new Je});const{params:U,...J}=j||{};if(z.equ(J,F,Z)||Q(F,{...J}),z.equ(U,F.params,Z)||Q(F,{params:{...F.params,...U}}),!M.camera||M.camera===m&&!z.equ(m,k,Z)){m=k;const C=k instanceof Pt,R=C?k:S?new bt(0,0,0,0,.1,1e3):new Et(75,0,.1,1e3);C||(R.position.z=5,k&&(Q(R,k),("aspect"in k||"left"in k||"right"in k||"bottom"in k||"top"in k)&&(R.manual=!0,R.updateProjectionMatrix())),!M.camera&&!(k!=null&&k.rotation)&&R.lookAt(0,0,0)),M.set({camera:R}),F.camera=R}if(!M.scene){let C;c!=null&&c.isScene?C=c:(C=new _t,c&&Q(C,c)),M.set({scene:te(C)})}if(!M.xr){var X;const C=(A,B)=>{const $=v.getState();$.frameloop!=="never"&&qe(A,!0,$,B)},R=()=>{const A=v.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?C:null),A.gl.xr.isPresenting||He(A)},I={connect(){const A=v.getState().gl;A.xr.addEventListener("sessionstart",R),A.xr.addEventListener("sessionend",R)},disconnect(){const A=v.getState().gl;A.xr.removeEventListener("sessionstart",R),A.xr.removeEventListener("sessionend",R)}};typeof((X=L.xr)==null?void 0:X.addEventListener)=="function"&&I.connect(),M.set({xr:I})}if(L.shadowMap){const C=L.shadowMap.enabled,R=L.shadowMap.type;if(L.shadowMap.enabled=!!y,z.boo(y))L.shadowMap.type=ge;else if(z.str(y)){var V;const I={basic:xt,percentage:Rt,soft:ge,variance:jt};L.shadowMap.type=(V=I[y])!=null?V:ge}else z.obj(y)&&Object.assign(L.shadowMap,y);(C!==L.shadowMap.enabled||R!==L.shadowMap.type)&&(L.shadowMap.needsUpdate=!0)}const E=rt();E&&("enabled"in E?E.enabled=!h:"legacyMode"in E&&(E.legacyMode=h)),s||Q(L,{outputEncoding:d?3e3:3001,toneMapping:g?St:Ct}),M.legacy!==h&&M.set(()=>({legacy:h})),M.linear!==d&&M.set(()=>({linear:d})),M.flat!==g&&M.set(()=>({flat:g})),r&&!z.fun(r)&&!dt(r)&&!z.equ(r,L,Z)&&Q(L,r),f&&!M.events.handlers&&M.set({events:f(v)});const P=on(e,a);return z.equ(P,M.size,Z)||M.setSize(P.width,P.height,P.updateStyle,P.top,P.left),x&&M.viewport.dpr!==lt(x)&&M.setDpr(x),M.frameloop!==_&&M.setFrameloop(_),M.onPointerMissed||M.set({onPointerMissed:T}),O&&!z.equ(O,M.performance,Z)&&M.set(C=>({performance:{...C.performance,...O}})),p=w,s=!0,this},render(o){return s||this.configure(),le.updateContainer(N.jsx(an,{store:v,children:o,onCreated:p,rootElement:e}),u,null,()=>{}),v},unmount(){pt(e)}}}function an({store:e,children:t,onCreated:n,rootElement:i}){return ce(()=>{const l=e.getState();l.set(v=>({internal:{...v.internal,active:!0}})),n&&n(l),e.getState().events.connected||l.events.connect==null||l.events.connect(i)},[]),N.jsx(Te.Provider,{value:e,children:t})}function pt(e,t){const n=oe.get(e),i=n==null?void 0:n.fiber;if(i){const l=n==null?void 0:n.store.getState();l&&(l.internal.active=!1),le.updateContainer(null,i,null,()=>{l&&setTimeout(()=>{try{var v,u,p,s;l.events.disconnect==null||l.events.disconnect(),(v=l.gl)==null||(u=v.renderLists)==null||u.dispose==null||u.dispose(),(p=l.gl)==null||p.forceContextLoss==null||p.forceContextLoss(),(s=l.gl)!=null&&s.xr&&l.xr.disconnect(),Vt(l),oe.delete(e)}catch{}},500)})}}function Ge(e,t,n){return N.jsx(ln,{children:e,container:t,state:n},t.uuid)}function ln({state:e={},children:t,container:n}){const{events:i,size:l,...v}=e,u=Le(),[p]=b.useState(()=>new Je),[s]=b.useState(()=>new Qe),m=b.useCallback((r,a)=>{const c={...r};Object.keys(r).forEach(w=>{(Jt.includes(w)||r[w]!==a[w]&&a[w])&&delete c[w]});let f;if(a&&l){const w=a.camera;f=r.viewport.getCurrentViewport(w,new Y,l),w!==r.camera&&ut(w,l)}return{...c,scene:n,raycaster:p,pointer:s,mouse:s,previousRoot:u,events:{...r.events,...a==null?void 0:a.events,...i},size:{...r.size,...l},viewport:{...r.viewport,...f},...v}},[e]),[o]=b.useState(()=>{const r=u.getState();return he((c,f)=>({...r,scene:n,raycaster:p,pointer:s,mouse:s,previousRoot:u,events:{...r.events,...i},size:{...r.size,...l},...v,set:c,get:f,setEvents:w=>c(y=>({...y,events:{...y.events,...w}}))}))});return b.useEffect(()=>{const r=u.subscribe(a=>o.setState(c=>m(a,c)));return()=>{r()}},[m]),b.useEffect(()=>{o.setState(r=>m(u.getState(),r))},[m]),b.useEffect(()=>()=>{o.destroy()},[]),N.jsx(N.Fragment,{children:le.createPortal(N.jsx(Te.Provider,{value:o,children:t}),o,null)})}le.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:b.version});const Me={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function cn(e){const{handlePointer:t}=Kt(e);return{priority:1,enabled:!0,compute(n,i,l){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Me).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:l}=e.getState();(n=l.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(l.lastEvent.current)},connect:n=>{var i;const{set:l,events:v}=e.getState();v.disconnect==null||v.disconnect(),l(u=>({events:{...u.events,connected:n}})),Object.entries((i=v.handlers)!=null?i:[]).forEach(([u,p])=>{const[s,m]=Me[u];n.addEventListener(s,p,{passive:m})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var l;Object.entries((l=i.handlers)!=null?l:[]).forEach(([v,u])=>{if(i&&i.connected instanceof HTMLElement){const[p]=Me[v];i.connected.removeEventListener(p,u)}}),n(v=>({events:{...v.events,connected:void 0}}))}}}}const un=b.forwardRef(function({children:t,fallback:n,resize:i,style:l,gl:v,events:u=cn,eventSource:p,eventPrefix:s,shadows:m,linear:o,flat:r,legacy:a,orthographic:c,frameloop:f,dpr:w,performance:y,raycaster:d,camera:g,scene:h,onPointerMissed:S,onCreated:_,...x},O){b.useMemo(()=>nt(kt),[]);const j=Ft(),[k,T]=At({scroll:!0,debounce:{scroll:50,resize:0},...i}),M=b.useRef(null),L=b.useRef(null);b.useImperativeHandle(O,()=>M.current);const F=it(S),[U,J]=b.useState(!1),[X,V]=b.useState(!1);if(U)throw U;if(X)throw X;const E=b.useRef(null);ce(()=>{const C=M.current;T.width>0&&T.height>0&&C&&(E.current||(E.current=sn(C)),E.current.configure({gl:v,events:u,shadows:m,linear:o,flat:r,legacy:a,orthographic:c,frameloop:f,dpr:w,performance:y,raycaster:d,camera:g,scene:h,size:T,onPointerMissed:(...R)=>F.current==null?void 0:F.current(...R),onCreated:R=>{R.events.connect==null||R.events.connect(p?Gt(p)?p.current:p:L.current),s&&R.setEvents({compute:(I,A)=>{const B=I[s+"X"],$=I[s+"Y"];A.pointer.set(B/A.size.width*2-1,-($/A.size.height)*2+1),A.raycaster.setFromCamera(A.pointer,A.camera)}}),_==null||_(R)}}),E.current.render(N.jsx(j,{children:N.jsx(st,{set:V,children:N.jsx(b.Suspense,{fallback:N.jsx(Xt,{set:J}),children:t??null})})})))}),b.useEffect(()=>{const C=M.current;if(C)return()=>pt(C)},[]);const P=p?"none":"auto";return N.jsx("div",{ref:L,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:P,...l},...x,children:N.jsx("div",{ref:k,style:{width:"100%",height:"100%"},children:N.jsx("canvas",{ref:M,style:{display:"block"},children:n})})})}),Nn=b.forwardRef(function(t,n){return N.jsx(zt,{children:N.jsx(un,{...t,ref:n})})});class fn extends je{constructor(t,n){super(),this.inputSource=null,this.xrControllerModel=null,this.index=t,this.controller=n.xr.getController(t),this.grip=n.xr.getControllerGrip(t),this.hand=n.xr.getHand(t),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(t){t.fake||t.data&&(this.visible=!0,this.inputSource=t.data,this.dispatchEvent(t))}_onDisconnected(t){t.fake||(this.visible=!1,this.inputSource=null,this.dispatchEvent(t))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var Xe,Ue;const dn=e=>Array.from(new Set(e)),q=typeof window<"u"&&((Xe=window.document)!=null&&Xe.createElement||((Ue=window.navigator)==null?void 0:Ue.product)==="ReactNative")?b.useLayoutEffect:b.useEffect;function G(e){const t=b.useRef(e);return q(()=>void(t.current=e),[e]),t}function ee(e,t,{handedness:n}={}){const i=G(t),l=D(v=>v.controllers);q(()=>{const v=l.map(u=>{if(n&&u.inputSource&&u.inputSource.handedness!==n)return;const p=s=>i.current({nativeEvent:s,target:u});return u.controller.addEventListener(e,p),()=>u.controller.removeEventListener(e,p)});return()=>v.forEach(u=>u==null?void 0:u())},[l,n,e])}const Ve=new Ze;function pn({children:e}){const t=ae(r=>r.events),n=ae(r=>r.get),i=ae(r=>r.raycaster),l=D(r=>r.controllers),v=D(r=>r.interactions),u=D(r=>r.hoverState),p=D(r=>r.hasInteraction),s=D(r=>r.getInteraction),m=b.useCallback(r=>{const a=Array.from(v.keys());return Ve.identity().extractRotation(r.matrixWorld),i.ray.origin.setFromMatrixPosition(r.matrixWorld),i.ray.direction.set(0,0,-1).applyMatrix4(Ve),i.intersectObjects(a,!0)},[v,i]);Ie(()=>{var r;if(v.size!==0)for(const a of l){if(!((r=a.inputSource)!=null&&r.handedness))return;const c=u[a.inputSource.handedness],f=new Set;let w=m(a.controller);if(t.filter)w=t.filter(w,n());else{const y=w.find(d=>d==null?void 0:d.object);y&&(w=[y])}for(const y of w){let d=y.object;for(;d;){if(p(d,"onHover")&&!c.has(d)){const h=s(d,"onHover");for(const S of h)S({target:a,intersection:y,intersections:w})}const g=s(d,"onMove");g==null||g.forEach(h=>h({target:a,intersection:y,intersections:w})),c.set(d,y),f.add(d.id),d=d.parent}}for(const y of c.keys())if(!f.has(y.id)){c.delete(y);const d=s(y,"onBlur");if(!d)continue;for(const g of d)g({target:a,intersections:w})}}});const o=b.useCallback(r=>a=>{var c;if(!((c=a.target.inputSource)!=null&&c.handedness))return;const f=u[a.target.inputSource.handedness],w=Array.from(new Set(f.values()));v.forEach((y,d)=>{var g,h,S;if(f.has(d)){if(!y[r])return;for(const _ of y[r])(g=_.current)==null||g.call(_,{target:a.target,intersection:f.get(d),intersections:w})}else if(r==="onSelect"&&y.onSelectMissed)for(const _ of y.onSelectMissed)(h=_.current)==null||h.call(_,{target:a.target,intersections:w});else if(r==="onSqueeze"&&y.onSqueezeMissed)for(const _ of y.onSqueezeMissed)(S=_.current)==null||S.call(_,{target:a.target,intersections:w})})},[u,v]);return ee("select",o("onSelect")),ee("selectstart",o("onSelectStart")),ee("selectend",o("onSelectEnd")),ee("squeeze",o("onSqueeze")),ee("squeezeend",o("onSqueezeEnd")),ee("squeezestart",o("onSqueezeStart")),b.createElement(b.Fragment,null,e)}function H(e,t,n){const i=D(u=>u.addInteraction),l=D(u=>u.removeInteraction),v=G(n);q(()=>{const u=e.current;if(!(!u||!v.current))return i(u,t,v),()=>l(u,t,v)},[e,t,i,l])}const vn=b.forwardRef(function({onHover:t,onBlur:n,onSelectStart:i,onSelectEnd:l,onSelectMissed:v,onSelect:u,onSqueezeStart:p,onSqueezeEnd:s,onSqueezeMissed:m,onSqueeze:o,onMove:r,children:a},c){const f=b.useRef(null);return b.useImperativeHandle(c,()=>f.current),H(f,"onHover",t),H(f,"onBlur",n),H(f,"onSelectStart",i),H(f,"onSelectEnd",l),H(f,"onSelectMissed",v),H(f,"onSelect",u),H(f,"onSqueezeStart",p),H(f,"onSqueezeEnd",s),H(f,"onSqueezeMissed",m),H(f,"onSqueeze",o),H(f,"onMove",r),b.createElement("group",{ref:f},a)});b.forwardRef(function({onSelectStart:t,onSelectEnd:n,children:i,...l},v){const u=b.useRef(),p=b.useRef(null),s=b.useMemo(()=>new Ze,[]);return b.useImperativeHandle(v,()=>p.current),Ie(()=>{const m=u.current,o=p.current;m&&(o.applyMatrix4(s),o.applyMatrix4(m.matrixWorld),o.updateMatrixWorld(),s.copy(m.matrixWorld).invert())}),b.createElement(vn,{ref:p,onSelectStart:m=>{u.current=m.target.controller,s.copy(m.target.controller.matrixWorld).invert(),t==null||t(m)},onSelectEnd:m=>{m.target.controller===u.current&&(u.current=void 0),n==null||n(m)},...l},i)});const vt=b.createContext(null),K=he((e,t)=>({set:e,get:t,session:null,referenceSpaceType:null}));function hn({foveation:e=0,frameRate:t=void 0,referenceSpace:n="local-floor",onSessionStart:i,onSessionEnd:l,onVisibilityChange:v,onInputSourcesChange:u,children:p}){const s=ae(h=>h.gl),m=ae(h=>h.camera),o=D(h=>h.player),r=D(h=>h.get),a=D(h=>h.set),c=D(h=>h.session),f=D(h=>h.controllers),w=G(i),y=G(l),d=G(v),g=G(u);return q(()=>{const h=[0,1].map(S=>{const _=new fn(S,s),x=()=>a(j=>({controllers:[...j.controllers,_]})),O=()=>a(j=>({controllers:j.controllers.filter(k=>k!==_)}));return _.addEventListener("connected",x),_.addEventListener("disconnected",O),()=>{_.removeEventListener("connected",x),_.removeEventListener("disconnected",O)}});return()=>h.forEach(S=>S())},[s,a]),q(()=>K.subscribe(({session:h})=>a(()=>({session:h}))),[s.xr,a]),q(()=>{s.xr.setFoveation(e),a(()=>({foveation:e}))},[s.xr,e,a]),q(()=>{var h;try{t&&((h=c==null?void 0:c.updateTargetFrameRate)==null||h.call(c,t))}catch{}a(()=>({frameRate:t}))},[c,t,a]),q(()=>{const h=K.getState();s.xr.setReferenceSpaceType(n),a(()=>({referenceSpace:n})),h.set({referenceSpaceType:n})},[s.xr,n,a]),q(()=>{if(!c)return void s.xr.setSession(null);const h=O=>{var j;a(()=>({isPresenting:!0})),(j=w.current)==null||j.call(w,{nativeEvent:{...O,target:c},target:c})},S=O=>{var j;a(()=>({isPresenting:!1,session:null})),K.setState(()=>({session:null})),(j=y.current)==null||j.call(y,{nativeEvent:{...O,target:c},target:c})},_=O=>{var j;(j=d.current)==null||j.call(d,{nativeEvent:O,target:c})},x=O=>{var j;const k=Object.values(c.inputSources).some(T=>T.hand);a(()=>({isHandTracking:k})),(j=g.current)==null||j.call(g,{nativeEvent:O,target:c})};return s.xr.addEventListener("sessionstart",h),s.xr.addEventListener("sessionend",S),c.addEventListener("visibilitychange",_),c.addEventListener("inputsourceschange",x),s.xr.setSession(c).then(()=>{s.xr.setFoveation(r().foveation)}),()=>{s.xr.removeEventListener("sessionstart",h),s.xr.removeEventListener("sessionend",S),c.removeEventListener("visibilitychange",_),c.removeEventListener("inputsourceschange",x)}},[c,s.xr,a,r]),b.createElement(pn,null,b.createElement("primitive",{object:o},b.createElement("primitive",{object:m}),f.map(h=>b.createElement("primitive",{key:h.index,object:h}))),p)}function Bn(e){const t=b.useMemo(()=>he((n,i)=>({set:n,get:i,controllers:[],isPresenting:!1,isHandTracking:!1,player:new je,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(l,v){var u;return!!((u=i().interactions.get(l))!=null&&u[v].some(p=>p.current))},getInteraction(l,v){var u;return(u=i().interactions.get(l))==null?void 0:u[v].reduce((p,s)=>(s.current&&p.push(s.current),p),[])},addInteraction(l,v,u){const p=i().interactions;p.has(l)||p.set(l,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]}),p.get(l)[v].push(u)},removeInteraction(l,v,u){const p=i().interactions.get(l);if(p){const s=p[v].indexOf(u);s!==-1&&p[v].splice(s,1)}}})),[]);return b.createElement(vt.Provider,{value:t},b.createElement(hn,{...e}))}const mn=(e,t)=>{var n;if(!(!e&&!t))return e&&!t?{optionalFeatures:[e]}:e&&t?{...t,optionalFeatures:dn([...(n=t.optionalFeatures)!=null?n:[],e])}:t},gn=async(e,t)=>{const n=K.getState();if(n.session){console.warn("@react-three/xr: session already started, please stop it first");return}const i=mn(n.referenceSpaceType,t),l=await navigator.xr.requestSession(e,i);return n.set(()=>({session:l})),l},yn=async()=>{const e=K.getState();if(!e.session){console.warn("@react-three/xr: no session to stop, please start it first");return}await e.session.end(),e.set({session:null})},wn=async(e,{sessionInit:t,enterOnly:n,exitOnly:i}={})=>{const l=K.getState();if(!(l.session&&n)&&!(!l.session&&i))return l.session?await yn():await gn(e,t)},bn=(e,t,n)=>{switch(e){case"entered":return`Exit ${t}`;case"exited":return`Enter ${t}`;case"unsupported":default:switch(n){case"https":return"HTTPS needed";case"security":return`${t} blocked`;case"unknown":default:return`${t} unsupported`}}},ht=b.forwardRef(function({mode:t,sessionInit:n,enterOnly:i=!1,exitOnly:l=!1,onClick:v,onError:u,children:p,...s},m){var o;const[r,a]=b.useState("exited"),[c,f]=b.useState("unknown"),w=bn(r,t,c),y=t==="inline"?t:`immersive-${t.toLowerCase()}`,d=G(u);q(()=>{if(!(navigator!=null&&navigator.xr))return void a("unsupported");navigator.xr.isSessionSupported(y).then(h=>{if(h)a("exited");else{const S=location.protocol==="https:";a("unsupported"),f(S?"unknown":"https")}}).catch(h=>{a("unsupported"),"name"in h&&h.name==="SecurityError"?f("security"):f("unknown")})},[y]),q(()=>K.subscribe(h=>{h.session?a("entered"):r!=="unsupported"&&a("exited")}),[r]);const g=b.useCallback(async h=>{v==null||v(h);try{wn(y,{sessionInit:n,enterOnly:i,exitOnly:l})}catch(S){const _=d.current;if(_&&S instanceof Error)_(S);else throw S}},[v,y,n,i,l,d]);return b.createElement("button",{...s,ref:m,onClick:r==="unsupported"?v:g},(o=typeof p=="function"?p(r):p)!=null?o:w)}),mt={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"},Hn=b.forwardRef(({style:e=mt,sessionInit:t={domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:n,...i},l)=>b.createElement(ht,{...i,ref:l,mode:"AR",style:e,sessionInit:t},n));b.forwardRef(({style:e=mt,sessionInit:t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:n,...i},l)=>b.createElement(ht,{...i,ref:l,mode:"VR",style:e,sessionInit:t},n));function D(e=n=>n,t){const n=b.useContext(vt);if(!n)throw new Error("useXR must be used within an <XR /> component!");return n(e,t)}const En="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",_n="generic-trigger";class Sn{constructor(t=null,n=En){this.gltfLoader=t??new Nt,this.path=n,this._assetCache={}}initializeControllerModel(t,n){return n.targetRayMode!=="tracked-pointer"||!n.gamepad?Promise.resolve():Bt(n,this.path,_n).then(({profile:i,assetPath:l})=>{if(!l)throw new Error("no asset path");const v=new Ht(n,i,l);t.connectMotionController(v);const u=v.assetUrl,p=this._assetCache[u];if(p){const s=p.scene.clone();t.connectModel(s)}else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(u,s=>{if(!t.motionController){console.warn("motionController gone while gltf load, bailing...");return}this._assetCache[u]=s;const m=s.scene.clone();t.connectModel(m)},void 0,()=>{throw new Error(`Asset ${u} missing or malformed.`)})}}).catch(i=>{console.warn(i)})}}const $e=e=>"envMap"in e,We=(e,t)=>{e.envMap=t,e.needsUpdate=!0},gt=(e,t)=>{t instanceof Oe&&(Array.isArray(t.material)?t.material.forEach(n=>$e(n)?We(n,e):void 0):$e(t.material)&&We(t.material,e))},Ye=e=>"envMapIntensity"in e,Ke=(e,t)=>{e.envMapIntensity=t,e.needsUpdate=!0},Re=(e,t)=>{t instanceof Oe&&(Array.isArray(t.material)?t.material.forEach(n=>Ye(n)?Ke(n,e):void 0):Ye(t.material)&&Ke(t.material,e))};function Cn(e,t){Object.values(e.components).forEach(n=>{const{type:i,touchPointNodeName:l,visualResponses:v}=n;if(i===ve.ComponentType.TOUCHPAD&&l)if(n.touchPointNode=t.getObjectByName(l),n.touchPointNode){const u=new Tt(.001),p=new Lt({color:255}),s=new Oe(u,p);n.touchPointNode.add(s)}else console.warn(`Could not find touch dot, ${n.touchPointNodeName}, in touchpad component ${n.id}`);Object.values(v).forEach(u=>{const{valueNodeName:p,minNodeName:s,maxNodeName:m,valueNodeProperty:o}=u;if(o===ve.VisualResponseProperty.TRANSFORM&&s&&m){if(u.minNode=t.getObjectByName(s),u.maxNode=t.getObjectByName(m),!u.minNode){console.warn(`Could not find ${s} in the model`);return}if(!u.maxNode){console.warn(`Could not find ${m} in the model`);return}}u.valueNode=t.getObjectByName(p),u.valueNode||console.warn(`Could not find ${p} in the model`)})})}function Mn(e,t){Cn(e.motionController,t),(e.envMap||e.envMapIntensity!=null)&&t.traverse(n=>{e.envMap&&gt(e.envMap,n),e.envMapIntensity!=null&&Re(e.envMapIntensity,n)}),e.add(t)}class Pn extends je{constructor(){super(),this.motionController=null,this.envMap=null,this.envMapIntensity=1,this.scene=null}setEnvironmentMap(t,n=1){var i;return this.envMap===t&&this.envMapIntensity===n?this:(this.envMap=t,this.envMapIntensity=n,(i=this.scene)==null||i.traverse(l=>{gt(t,l),Re(n,l)}),this)}setEnvironmentMapIntensity(t){var n;return this.envMapIntensity===t?this:(this.envMapIntensity=t,(n=this.scene)==null||n.traverse(i=>Re(t,i)),this)}connectModel(t){if(!this.motionController){console.warn("scene tried to add, but no motion controller");return}this.scene=t,Mn(this,t),this.dispatchEvent({type:"modelconnected",data:t})}connectMotionController(t){this.motionController=t,this.dispatchEvent({type:"motionconnected",data:t})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(n=>{Object.values(n.visualResponses).forEach(i=>{const{valueNode:l,minNode:v,maxNode:u,value:p,valueNodeProperty:s}=i;l&&(s===ve.VisualResponseProperty.VISIBILITY&&typeof p=="boolean"?l.visible=p:s===ve.VisualResponseProperty.TRANSFORM&&v&&u&&typeof p=="number"&&(l.quaternion.slerpQuaternions(v.quaternion,u.quaternion,p),l.position.lerpVectors(v.position,u.position,p)))})}))}disconnect(){this.dispatchEvent({type:"motiondisconnected",data:this.motionController}),this.dispatchEvent({type:"modeldisconnected",data:this.scene}),this.motionController=null,this.scene&&this.remove(this.scene),this.scene=null}dispose(){this.disconnect()}}const xn=b.forwardRef(function({target:t,hideOnBlur:n=!1,...i},l){const v=D(s=>s.hoverState),u=b.useRef(null),p=b.useMemo(()=>new It().setFromPoints([new Y(0,0,0),new Y(0,0,-1)]),[]);return b.useImperativeHandle(l,()=>u.current),Ie(()=>{if(!t.inputSource)return;let s=1;const m=v[t.inputSource.handedness].values().next().value;m&&t.inputSource.handedness!=="none"?(s=m.distance,n&&(u.current.visible=!1)):n&&(u.current.visible=!0);const o=-.01;u.current.scale.z=s+o}),b.createElement("line",{ref:u,geometry:p,"material-opacity":.8,"material-transparent":!0,...i})}),Rn=new Sn,jn=({target:e,envMap:t,envMapIntensity:n})=>{const i=b.useRef(null),l=G(s=>{t!=null&&s.setEnvironmentMap(t)}),v=G(s=>s.setEnvironmentMap(null)),u=G(s=>{n!=null&&s.setEnvironmentMapIntensity(n)}),p=b.useCallback(s=>{var m,o,r;if(i.current=s,s){if(e.xrControllerModel=s,(m=e.inputSource)!=null&&m.hand)return;l.current(s),u.current(s),e.inputSource?Rn.initializeControllerModel(s,e.inputSource):console.warn("no input source on XRController when handleControllerModel")}else{if((o=e.inputSource)!=null&&o.hand)return;(r=e.xrControllerModel)==null||r.disconnect(),e.xrControllerModel=null}},[e,u,l]);return b.useLayoutEffect(()=>{i.current&&(t?l.current(i.current):v.current(i.current))},[t,l,v]),b.useLayoutEffect(()=>{i.current&&u.current(i.current)},[n,u]),b.createElement("xRControllerModel",{ref:p})};function qn({rayMaterial:e={},hideRaysOnBlur:t=!1,envMap:n,envMapIntensity:i}){const l=D(p=>p.controllers),v=D(p=>p.isHandTracking),u=b.useMemo(()=>Object.entries(e).reduce((p,[s,m])=>({...p,[`material-${s}`]:m}),{}),[JSON.stringify(e)]);return b.useMemo(()=>nt({XRControllerModel:Pn}),[]),b.createElement(b.Fragment,null,l.map((p,s)=>b.createElement(b.Fragment,{key:s},Ge(b.createElement(jn,{target:p,envMap:n,envMapIntensity:i}),p.grip),Ge(b.createElement(xn,{visible:!v,hideOnBlur:t,target:p,...u}),p.controller))))}export{Hn as A,Nn as C,Bn as X,qn as a,Fn as c,Dn as g};
